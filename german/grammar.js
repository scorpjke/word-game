let strong_verbs = {};

`backen  bäckt/backte 	backte/buk  gebacken 	
befehlen  befiehlt  befahl 	befohlen 	
beginnen 	- 	begann 	begonnen 	2
beißen 	- 	biss 	gebissen 	
bergen 	birgt 	barg 	geborgen 	
bersten 	birst/berstet 	barst 	geborsten 	
bewegen 	- 	bewog 	bewogen 	
biegen 	- 	bog 	gebogen 	
bieten 	- 	bot 	geboten 	
binden 	- 	band 	gebunden 	
bitten 	- 	bat 	gebeten 	2
blasen 	bläst 	blies 	geblasen 	
bleiben 	- 	blieb 	geblieben 	1
braten 	brät 	briet 	gebraten 	
brechen 	bricht 	brach 	gebrochen 	2
brennen  	- 	brannte 	gebrannt 	
bringen  	- 	brachte 	gebracht 	1
denken  	- 	dachte 	gedacht 	1
dreschen 	drischt 	drosch 	gedroschen 	
dringen 	- 	drang 	gedrungen 	
dürfen  	darf 	durfte 	gedurft 	1
empfehlen 	empfiehlt 	empfahl 	empfohlen 	
erkiesen  	- 	erkor 	erkoren 	
erklimmen  	- 	erklomm 	erklommen 	
erlöschen 	erlischt 	erlosch 	erloschen 	
erschrecken 	erschrickt 	erschrak 	erschrocken 	
essen 	isst 	aß 	gegessen 	1
fahren 	fährt 	fuhr 	gefahren 	1
fallen 	fällt 	fiel 	gefallen 	2
fangen 	fängt 	fing 	gefangen 	2
fechten 	ficht 	focht 	gefochten 	
finden 	- 	fand 	gefunden 	1
flechten 	flicht 	flocht 	geflochten 	
fliegen 	- 	flog 	geflogen 	
fliehen 	- 	floh 	geflohen 	
fließen 	- 	floß 	geflossen 	
fressen 	frisst 	fraß 	gefressen 	
frieren 	- 	fror 	gefroren 	
gären 	- 	gärte/gor 	gegärt/gegoren 	
gebären 	gebärt/gebiert 	gebar 	geboren 	
geben 	gibt 	gab 	gegeben 	1
gedeihen 	- 	gedieh 	gediehen 	
gehen 	- 	ging 	gegangen 	1
gelingen 	- 	gelang 	gelungen 	
gelten 	gilt 	galt 	gegolten 	
genesen 	- 	genas 	genesen 	
genießen 	- 	genoss 	genossen 	
geschehen 	geschieht 	geschah 	geschehen 	
gewinnen 	- 	gewann 	gewonnen 	1
gießen 	- 	goss 	gegossen 	
gleichen 	- 	glich 	geglichen 	
gleiten 	- 	glitt 	geglitten 	
glimmen  	- 	glomm 	geglommen 	
graben 	gräbt 	grub 	gegraben 	
greifen 	- 	griff 	gegriffen 	
haben  	hat 	hatte 	gehabt 	1
halten 	hält 	hielt 	gehalten 	1
hängen 	- 	hing 	gehangen 	
hauen 	- 	hieb 	gehauen 	
heben 	- 	hob 	gehoben 	
heißen 	- 	hieß 	geheißen 	1
helfen 	hilft 	half 	geholfen 	1
kennen  	- 	kannte 	gekannt 	1
klingen 	- 	klang 	geklungen 	2
kneifen 	- 	kniff 	gekniffen 	
kommen 	- 	kam 	gekommen 	1
können  	kann 	konnte 	gekonnt 	1
kriechen 	- 	kroch 	gekrochen 	
laden 	lädt 	lud 	geladen 	2
lassen 	lässt 	ließ 	gelassen 	1
laufen 	läuft 	lief 	gelaufen 	1
leiden 	- 	litt 	gelitten 	
leihen 	- 	lieh 	geliehen 	
lesen 	liest 	las 	gelesen 	1
liegen 	- 	lag 	gelegen 	1
lügen 	- 	log 	gelogen 	
mahlen 	- 	mahlte 	gemahlen 	
meiden 	- 	mied 	gemieden 	
melken 	milkt/melkt 	melkte 	gemolken 	
messen 	misst 	maß 	gemessen 	
misslingen 	- 	misslang 	misslungen 	
mögen  	mag 	mochte 	gemocht 	1
müssen  	muss 	musste 	gemusst 	1
nehmen 	nimmt 	nahm 	genommen 	1
nennen  	- 	nannte 	genannt 	2
pfeifen 	- 	pfiff 	gepfiffen 	
preisen 	- 	pries 	gepriesen 	
quellen 	quillt 	quoll 	gequollen 	
raten 	rät 	riet 	geraten 	
reiben 	- 	rieb 	gerieben 	
reißen 	- 	riss 	gerissen 	
reiten 	- 	ritt 	geritten 	
rennen  	- 	rannte 	gerannt 	
riechen 	- 	roch 	gerochen 	
ringen 	- 	rang 	gerungen 	
rinnen 	- 	rann 	geronnen 	
rufen 	- 	rief 	gerufen 	2
salzen 	- 	salzte 	gesalzen 	
saufen 	säuft 	soff 	gesoffen 	
saugen 	- 	sog 	gesogen 	
schaffen 	- 	schuf 	geschaffen 	1
scheiden 	- 	schied 	geschieden 	
scheinen 	- 	schien 	geschienen 	1
scheißen 	- 	schiss 	geschissen 	
schelten 	schilt 	schalt 	gescholten 	
scheren 	- 	schor 	geschoren 	
schieben 	- 	schob 	geschoben 	
schießen 	- 	schoss 	geschossen 	
schinden 	- 	schindete 	geschunden 	
schlafen 	schläft 	schlief 	geschlafen 	1
schlagen 	schlägt 	schlug 	geschlagen 	
schleichen 	- 	schlich 	geschlichen 	
schleifen 	- 	schliff 	geschliffen 	
schließen 	- 	schloss 	geschlossen 	2
schlingen 	- 	schlang 	geschlungen 	
schmeißen 	- 	schmiss 	geschmissen 	
schmelzen 	schmilzt 	schmolz 	geschmolzen 	
schneiden 	- 	schnitt 	geschnitten 	2
schreiben 	- 	schrieb 	geschrieben 	1
schreien 	- 	schrie 	geschrien 	
schreiten 	- 	schritt 	geschritten 	
schweigen 	- 	schwieg 	geschwiegen 	
schwellen 	schwillt 	schwoll 	geschwollen 	
schwimmen 	- 	schwamm 	geschwommen 	2
schwinden 	- 	schwand 	geschwunden 	
schwingen 	- 	schwang 	geschwungen 	
schwören 	- 	schwor 	geschworen 	
sehen 	sieht 	sah 	gesehen 	1
sein  	is 	war 	gewesen 	1
senden  	- 	sandte 	gesandt 	
sieden  	- 	siedete/sott 	gesotten 	
singen 	- 	sang 	gesungen 	2
sinken 	- 	sank 	gesunken 	
sinnen 	- 	sann 	gesonnen 	
sitzen 	- 	saß 	gesessen 	1
sollen  	soll 	sollte 	gesollt 	1
spalten 	- 	spaltete 	gespalten/gespaltet 	
speien 	- 	spie 	gespien 	
spinnen 	- 	spann 	gesponnen 	
sprechen 	spricht 	sprach 	gesprochen 	1
sprießen 	- 	sproß 	gesprossen 	
springen 	- 	sprang 	gesprungen 	
stechen 	sticht 	stach 	gestochen 	
stehen 	- 	stand 	gestanden 	1
stehlen 	stiehlt 	stahl 	gestohlen 	
steigen 	- 	stieg 	gestiegen 	
sterben 	stirbt 	starb 	gestorben 	
stinken 	- 	stank 	gestunken 	
stoßen 	stößt 	stieß 	gestoßen 	
streichen 	- 	strich 	gestrichen 	
streiten 	- 	stritt 	gestritten 	
tragen 	trägt 	trug 	getragen 	1
treffen 	trifft 	traf 	getroffen 	2
treiben 	- 	trieb 	getrieben 	
treten 	- 	tritt 	getreten 	
trinken 	- 	trank 	getrunken 	1
trügen 	- 	trog 	getrogen 	
tun 	- 	tat 	getan 	1
verderben 	verdirbt 	verdarb 	verdorben 	
verdrießen 	- 	verdross 	verdrossen 	
vergessen 	vergisst 	vergaß 	vergessen 	1
verlieren 	- 	verlor 	verloren 	1
verzeihen 	- 	verzieh 	verziehen 	
wachsen 	wächst 	wuchs 	gewachsen 	
wägen 	- 	wog 	gewogen 	
waschen 	wäscht 	wusch 	gewaschen 	2
weichen 	- 	wich 	gewichen 	
weisen 	- 	wies 	gewiesen 	
wenden  	- 	wandte 	gewandt 	
werben 	wirbt 	warb 	geworben 	
werden  	wird 	wurde 	geworden 	1
werfen 	wirft 	warf 	geworfen 	
wiegen 	- 	wog 	gewogen 	
winden 	- 	wand 	gewunden 	
wissen  	weiß 	wusste 	gewusst 	1
wollen  	will 	wollte 	gewollt 	1
wringen 	- 	wrang 	gewrungen 	
ziehen 	- 	zog 	gezogen 	1
zwingen 	- 	zwang 	gezwungen    `
.split('\n').forEach(function(line){
    line = line.split(/[\t ]+/);
    if (line.length == 0) return;
    let res = {};
    if (line[1] != '-') res.special_v_er = line[1];
    res.v2 = line[2];
    res.v3 = line[3];

    //if (line[4]) res.irr_diff = parseInt(line[4]);
    strong_verbs[line[0]] = res;
});



class Verb {
    constructor(verb) {
        let V = this;
        
        //console.log(verb);
        let s = `(kn|pf|str?|spr?|sch[lmnrw]?|[tdkgpbf]r|[kgfbp]l|pfl|zw|qu|ch|[wrtpsdfghjklzvbnm])?[aiueoäüö]`;
        let p = '(' + Verb.all_pref.join('|') + ')';
        let found = verb.match(`^${p}*(${s}.+)(en)`) || verb.match(`^${p}*(${s}.*e[rl])(n)`) || verb.match(`^${p}*((t)u)(n)`) || verb.match(`^${p}*((s)ei)(n)`);

        V.stem = found[2];
        V.rest = found[2] + found[4];

        V.sep_pref = [];
        V.insep_pref = [];

        if (found[1]) {
            let prefixes = verb.slice(0, verb.length - V.rest.length).replace( new RegExp(p, 'g'), '$1 ').trim().split(' ');
            V.number_of_prefixes = prefixes.length;

            let s = V.sep_pref;

            for (let pr of prefixes) {
                if (Verb.insep_pref.includes(pr) ) s = V.insep_pref;
                s.push(pr);
            }
        }
        V.sep_pref = V.sep_pref.join('');
        V.insep_pref = V.insep_pref.join('');

        
        if (V.sep_pref) {
            V.prefix_type = V.insep_pref ? 'both' : 'sep';
        }
        else if (V.insep_pref) V.prefix_type = 'insep';
        else V.prefix_type = 'none';

        let found2 = strong_verbs[verb] || strong_verbs[V.insep_pref + V.rest] || strong_verbs[V.rest];
        
        if (found2) {
            Object.assign(V, found2);
            //if (!V.irr_diff) V.irr_diff = 3;
            V.irr_diff = true;

            if (V.special_v_er && !V.special_v_er.match(/[td]$/))
                V.modal = true;
        }
        else {
            V.irr_diff = false;
            let t = smart_unite(V.stem, 't');
            V.v2 = t + 'e';
            V.v3 = 'ge' + t;
        }
        
        function detach(w, pref) {
            return w.replace(new RegExp(`^${pref}`), '');
        }

        if (V.insep_pref) {
            if (V.special_v_er)
                V.special_v_er = detach(V.special_v_er, V.insep_pref); 

            V.v2 = detach(V.v2, V.insep_pref);
            V.v3 = detach(V.v3, 'ge');
            V.v3 = detach(V.v3, V.insep_pref);
        }
        if (V.stem.match(/ier$/)) V.v3 = detach(V.v3, 'ge');
    }

    make(tense, person) {
        let V = this;
        let res = [];
        let p;

        if (tense == 'inf') return [V.sep_pref + V.insep_pref + V.rest];
        else if (tense == 'zu-inf') {
            if (V.sep_pref) return [V.sep_pref + 'zu' + V.insep_pref + V.rest];
            else return ['zu', V.insep_pref + V.rest];
        }
        else if (tense == 'past participle') return [V.sep_pref + V.insep_pref + V.v3];
        
        if (['ich','du','ihr','wir','sie'].includes(person)) p = person;
        else p = 'er';

        let res_stem = V.stem;
        let res_ending = Verb.standard_endings[p];

        if (tense == 'present') {
            if (V.rest == 'sein') {
                res.push({'ich':'bin', 'du':'bist', 'er':'ist', 'wir':'sind', 'ihr':'seid', 'sie':'sind'}[p]);
            }
            else if (p == 'ich' && V.modal) {
                res.push(V.special_v_er);
            }
            else if (V.special_v_er && (p == 'du' || p == 'er')) {
                if (p == 'er') res.push(V.special_v_er);
                else res_stem = V.special_v_er.replace(/[td]$/, '');
            }
            else if (p == 'sie' || p == 'wir')
                res.push(V.rest);
        }
        else if (tense.includes('perfect')) {
            let time = tense.split(' ')[0];
            let aux = 'haben';
            if (Verb.verbs_that_use_sein.includes(V.rest) || Verb.verbs_that_use_sein.includes(V.in('inf'))) {
                aux = 'sein';
            }
            aux = new Verb(aux).make(time, p);
            
            if (time == 'future') aux = [aux[0], V.in('past participle'), aux[1]];
            else aux.push(V.in('past participle'));

            return aux;
        }
        else if (tense == 'future') {
            let aux = new Verb('werden').make('present', p);
            aux.push(V.in('inf') );
            return aux;
        }
        else if (tense == 'fake subjunctive') {
            let aux = new Verb('würden').make('present', p);
            aux.push(V.in('inf') );
            return aux;
        }
        else if (tense == 'real subjunctive') {
            res_stem = umlautify(V.v2.replace(/e$/, ''));
            let tr = {'du':'est', 'er':'e', 'ihr':'et'};
            if (tr[p]) res_ending = tr[p];
        }
        else if (tense == 'subjunctive') {
            return V.make( (V.modal || ['haben','sein'].includes(V.rest) ? 'real':'fake') + ' subjunctive', person);
        }
        else if (tense == 'preterite' || tense == 'past simple') {
            if (p == 'ich' || p == 'er') res.push(V.v2);
            else res_stem = V.v2.replace(/e$/, '');
        }

        if (res.length == 0) res.push(smart_unite(res_stem, res_ending));

        if (V.insep_pref) res[0] = V.insep_pref + res[0];
        if (V.sep_pref) res.push(V.sep_pref);
        
        return res;
    }

    in(tense, person) {
        return this.make(tense, person).join(' ');
    }

    full_conjugation() {
        for (let form of ['inf', 'zu-inf', 'past participle']) {
            console.log('---------' + form + '---------');
            console.log(this.in(form));
        }
        for (let tense of ['present','present perfect', 'future', 'future perfect', 'preterite', 'preterite perfect', 'subjunctive', 'subjunctive perfect']) {
            console.log('---------' + tense + '---------');
            for (let person of ['ich','du','er','wir','ihr','sie']) {
                console.log([person].concat(this.make(tense,person)).join(' '));
            }
        }
    }
}

Verb.sep_pref = "ab an auf aus bei bevor durch ein fest fort gegen hinter hin her los mit nach statt vor weg weiter wieder zusammen zurück zu".split(' ');
Verb.insep_pref = "be emp ent er ge miss über un unter um wider ver voll zer".split(' ');
Verb.all_pref = Verb.sep_pref.concat(Verb.insep_pref).sort( (a,b) => a.length < b.length );

Verb.verbs_that_use_sein = `aufwachen bleiben erscheinen ertrinken fahren fallen fliegen folgen gebren gehen gelingen geschehen joggen klettern kommen kriechen laufen passieren reisen reiten rennen schlafen schwimmen sein sinken springen steigen sterben treten wachsen wandern werden`.split(' ');
Verb.standard_endings = {'ich':'e', 'du':'st', 'er':'t', 'ihr':'t', 'wir':'en', 'sie':'en'};


function smart_unite(stem, ending) {
    if (stem.match(/[td]$/) && ending.match(/^s?t/) )
        return stem + 'e' + ending;
    else if (stem.match(/[szß]$/) && ending.match(/^s/) )
        return stem + ending.slice(1);
    else if (stem.match(/(ch|[ptkbdgfslrzw])[nm]$/) && ending.match(/^s?t/) )
        return stem + 'e' + ending;
    
    return stem + ending;
}


function umlautify(stem) {
    return stem.replace(/[aou]/, function(x){
        return {'a':'ä', 'o':'ö', 'u':'ü'}[x];
    });
}